title Get User Cart Sequence Diagram

participant Client
participant CartController
participant CartService
participant CartRepository
participant Database

Client->CartController: 1. GET /api/Cart
activate CartController

CartController->CartController: 2. GetCurrentUserId() (from JWT)
CartController->CartService: 3. GetCartByUserIdAsync(userId, ct)
activate CartService

CartService->CartRepository: 4. GetCartByUserIdWithRelationsAsync(userId)
activate CartRepository
CartRepository->Database: 5. Query cart by userId with items and product details
activate Database
Database-->CartRepository: 6. Return cart or null
deactivate Database
CartRepository-->CartService: 7. Return cart or null
deactivate CartRepository

alt Cart Not Exists
    CartService-->CartController: 8a. Return null
    deactivate CartService
    CartController->Client: 9a. Return 200 OK (null)
    deactivate CartController
else Cart Exists
    CartService->CartService: 8b. Map to CartResponseDTO
    CartService->CartService: 9b. PopulateCartItemsImagesAsync() - load product images
    CartService->CartRepository: 10b. Query product images for each cart item
    activate CartRepository
    CartRepository->Database: 11b. Query media_links for products
    activate Database
    Database-->CartRepository: 12b. Return images
    deactivate Database
    CartRepository-->CartService: 13b. Return images
    deactivate CartRepository
    CartService->CartService: 14b. Populate images to CartResponseDTO
    CartService-->CartController: 15b. Return CartResponseDTO
    deactivate CartService
    CartController->Client: 16b. Return 200 OK (CartResponseDTO)
    deactivate CartController
end

note over Client,Database: Returns null if cart doesn't exist\nPopulates product images for cart items
