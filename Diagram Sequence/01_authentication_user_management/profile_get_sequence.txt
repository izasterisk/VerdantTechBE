title Get User Profile Sequence Diagram

participant Client
participant AuthController
participant UserService
participant UserRepository
participant Database

Client->AuthController: 1. GET /api/Auth/profile
activate AuthController

note over AuthController: Requires Authorization (JWT Token)

AuthController->AuthController: 2. GetCurrentUserId() (from JWT)
AuthController->UserService: 3. Call GetUserByIdAsync(userId, cancellationToken)
activate UserService

UserService->UserRepository: 4. GetUserWithAddressesByIdAsync(userId, cancellationToken)
activate UserRepository
UserRepository->Database: 5. Query user by ID with addresses
activate Database
Database-->UserRepository: 6. Return user data or null
deactivate Database
UserRepository-->UserService: 7. Return user or null
deactivate UserRepository

alt User Not Found
    UserService->UserService: 8a. Throw Exception("Người dùng với ID {userId} không tồn tại")
    UserService-->AuthController: 9a. Exception propagated
    AuthController->AuthController: 10a. HandleException(ex)
    AuthController->Client: 11a. Return 500 Internal Server Error
    deactivate UserService
    deactivate AuthController
else User Found
    UserService->UserService: 8b. Map User to UserResponseDTO
    UserService-->AuthController: 9b. Return UserResponseDTO
    deactivate UserService
    AuthController->Client: 10b. Return 200 OK (UserResponseDTO)
    deactivate AuthController
end

note over Client,Database: Profile endpoint returns user info with addresses\nfrom JWT token authentication

