title User Delete Sequence Diagram

participant Admin
participant UserManagementUI
participant UserController
participant UserService
participant UserRepository
participant Database

Admin->UserManagementUI: 1. Select user(s) to delete
UserManagementUI->Admin: 2. Show delete options (Soft Delete / Permanent Delete)

alt [Soft Delete]
    UserManagementUI->UserController: 3.1 Choose Soft Delete
    activate UserController
    UserController->UserService: 4.1 Call UpdateUserAsync(id, {Status: Deleted})
    activate UserService
    
    UserService->UserRepository: 5.1 GetUserWithAddressesByIdAsync(id)
    activate UserRepository
    UserRepository->Database: 6.1 Check if user exists
    Database-->UserRepository: 7.1 Return user data
    UserRepository-->UserService: 8.1 Return user or null
    deactivate UserRepository
    
    alt User Not Found
        UserService-->UserController: 7.1.1 Return failure message
        UserController->UserManagementUI: 8.1.1 Return 404 Not Found
        UserManagementUI->Admin: 9.1.1 Show error message
        deactivate UserService
        deactivate UserController
    else User Found
        UserService->UserService: 9.1.2 Set user.Status = Deleted
        UserService->UserService: 9.1.3 Set user.DeletedAt = DateTime.UtcNow
        UserService->UserRepository: 10.1.2 UpdateUserWithTransactionAsync(user)
        activate UserRepository
        UserRepository->Database: 11.1.2 Update user status to inactive
        Database-->UserRepository: 12.1.2 Return success
        UserRepository-->UserService: 13.1.2 Return updated user
        deactivate UserRepository
        UserService-->UserController: 14.1.2 Return soft delete success
        deactivate UserService
        UserController->UserManagementUI: 15.1.2 Show soft delete success
        deactivate UserController
        UserManagementUI->Admin: 16.1.2 Display updated user status
    end

else [Permanent Delete]
    UserManagementUI->UserController: 3.2 Choose Permanent Delete
    activate UserController
    UserController->UserService: 4.2 Call DeleteUserPermanentlyAsync(id)
    activate UserService
    
    UserService->UserRepository: 5.2 GetUserWithAddressesByIdAsync(id)
    activate UserRepository
    UserRepository->Database: 6.2 Check if user exists
    Database-->UserRepository: 7.2 Return user data
    UserRepository-->UserService: 8.2 Return user or null
    deactivate UserRepository
    
    alt User Not Found
        UserService-->UserController: 7.2.1 Return failure message
        UserController->UserManagementUI: 8.2.1 Return 404 Not Found
        UserManagementUI->Admin: 9.2.1 Show error message
        deactivate UserService
        deactivate UserController
    else User Found
        UserService->UserRepository: 9.2.2 DeleteUserPermanentlyAsync(id)
        activate UserRepository
        UserRepository->Database: 10.2.2 Remove user(s) from database
        Database-->UserRepository: 11.2.2 Return success
        UserRepository-->UserService: 12.2.2 Return delete result
        deactivate UserRepository
        UserService-->UserController: 13.2.2 Return delete success
        deactivate UserService
        UserController->UserManagementUI: 14.2.2 Show delete success
        deactivate UserController
        UserManagementUI->Admin: 15.2.2 Confirm deletion
    end
end
