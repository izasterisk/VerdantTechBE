title Delete User Bank Account Sequence Diagram

participant Client
participant UserBankAccountsUI
participant UserBankAccountsController
participant UserBankAccountsService
participant UserBankAccountsRepository
participant Database

Client->UserBankAccountsUI: 1. Request delete bank account (accountId)
UserBankAccountsUI->UserBankAccountsController: 2. DELETE /api/UserBankAccounts/{accountId}
activate UserBankAccountsController

UserBankAccountsController->UserBankAccountsService: 3. Call DeleteUserBankAccountAsync(accountId)
activate UserBankAccountsService

UserBankAccountsService->UserBankAccountsRepository: 4. GetUserBankAccountByIdAsync(accountId)
activate UserBankAccountsRepository
UserBankAccountsRepository->Database: 5. Get bank account by ID
Database-->UserBankAccountsRepository: 6. Return UserBankAccount or null
UserBankAccountsRepository-->UserBankAccountsService: 7. Return UserBankAccount
deactivate UserBankAccountsRepository

alt Account Not Found
    UserBankAccountsService-->UserBankAccountsController: 8.1 Throw exception
    UserBankAccountsController->UserBankAccountsUI: 9.1 Return 404 Not Found
    deactivate UserBankAccountsService
    deactivate UserBankAccountsController
else Account Found
    UserBankAccountsService->UserBankAccountsRepository: 8.2 DeleteUserBankAccountWithTransactionAsync(account)
    activate UserBankAccountsRepository
    UserBankAccountsRepository->Database: 9.2 Delete bank account (transaction)
    Database-->UserBankAccountsRepository: 10.2 Return delete result
    UserBankAccountsRepository-->UserBankAccountsService: 11.2 Return bool (success)
    deactivate UserBankAccountsRepository

    UserBankAccountsService-->UserBankAccountsController: 12.2 Return bool (success)
    deactivate UserBankAccountsService

    UserBankAccountsController->UserBankAccountsUI: 13.2 Return 200 OK (APIResponse)
    deactivate UserBankAccountsController
    UserBankAccountsUI->Client: 14.2 Display success message
end

