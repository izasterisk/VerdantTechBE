title Delete Product Sequence Diagram

participant Client
participant ProductController
participant ProductService
participant ProductRepository
participant Database

Client->ProductController: 1. DELETE /api/Product/{id}
activate ProductController

ProductController->ProductService: 2. Call DeleteAsync(id, cancellationToken)
activate ProductService

ProductService->ProductRepository: 3. DeleteAsync(id)
activate ProductRepository
ProductRepository->Database: 4. Query product by ID
activate Database
Database-->ProductRepository: 5. Return product or null
deactivate Database

alt Product Not Found
    ProductRepository-->ProductService: 6a. Return false
    deactivate ProductRepository
    ProductService-->ProductController: 7a. Return false
    deactivate ProductService
    ProductController->Client: 8a. Return 404 Not Found
    deactivate ProductController
else Product Found
    ProductRepository->Database: 6b. Begin Transaction
    activate Database
    ProductRepository->Database: 7b. Query MediaLinks (product images)
    Database-->ProductRepository: 8b. Return media list
    alt Has Media Images
        ProductRepository->Database: 9b1. RemoveRange(medias)
    end
    ProductRepository->Database: 9b2. Remove(product)
    Database-->ProductRepository: 10b. Changes tracked
    ProductRepository->Database: 11b. SaveChangesAsync()
    Database-->ProductRepository: 12b. Changes saved
    ProductRepository->Database: 13b. Commit Transaction
    Database-->ProductRepository: 14b. Transaction committed
    deactivate Database
    ProductRepository-->ProductService: 15b. Return true
    deactivate ProductRepository
    ProductService-->ProductController: 16b. Return true
    deactivate ProductService
    ProductController->Client: 17b. Return 204 No Content
    deactivate ProductController
end

note over Client,Database: Hard delete: removes product and all related media images\nUses transaction to ensure data consistency
